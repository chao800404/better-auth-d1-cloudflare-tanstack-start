{
  "$schema": "https://deploy.workers.cloudflare.com/schema.json",
  "name": "better-auth-cloudflare-tanstack-start",
  "type": "javascript",
  "build": {
    "command": "pnpm install && pnpm build",
    "cwd": "./",
    "watch_paths": ["src/**/*"]
  },
  "deploy": {
    "workers_dev": true,
    "routes": []
  },
  "env": {
    "BETTER_AUTH_SECRET": {
      "type": "secret",
      "description": "Secret key for Better Auth (default provided for testing - change for production!)",
      "default": "NkxvvpZX6N3/2A0dG5o1HCXky8siWCQQU3aWzO2+04s="
    },
    "PUBLIC_URL": {
      "type": "plain_text",
      "description": "Public URL of your deployed worker (e.g., https://your-worker.workers.dev)"
    }
  },
  "resources": {
    "d1_databases": [
      {
        "binding": "DATABASE",
        "name": "better-auth-db",
        "description": "D1 database for Better Auth"
      }
    ],
    "kv_namespaces": [
      {
        "binding": "KV",
        "name": "better-auth-kv",
        "description": "KV namespace for rate limiting"
      }
    ],
    "r2_buckets": [
      {
        "binding": "R2_BUCKET",
        "name": "better-auth-r2",
        "description": "R2 bucket for file uploads (optional)"
      }
    ]
  },
  "setup": {
    "steps": [
      {
        "title": "Install dependencies",
        "command": "pnpm install"
      },
      {
        "title": "Generate Better Auth schema",
        "command": "pnpm auth:generate"
      },
      {
        "title": "Generate database migrations",
        "command": "pnpm db:generate"
      },
      {
        "title": "Apply migrations to D1 database",
        "command": "wrangler d1 migrations apply DATABASE --remote"
      }
    ]
  }
}
